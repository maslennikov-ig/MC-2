{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://megacampusai.com/schemas/summarization-result.json",
  "title": "SummarizationResult",
  "description": "Result of Stage 3 summarization job (saved to file_catalog)",
  "type": "object",
  "required": [
    "file_id",
    "processed_content",
    "processing_method",
    "summary_metadata"
  ],
  "properties": {
    "file_id": {
      "type": "string",
      "format": "uuid",
      "description": "File catalog identifier"
    },
    "processed_content": {
      "type": "string",
      "minLength": 1,
      "maxLength": 1000000,
      "description": "LLM-generated summary or full text (if bypassed)"
    },
    "processing_method": {
      "type": "string",
      "enum": [
        "full_text",
        "map_reduce",
        "refine",
        "map_rerank",
        "stuffing",
        "hierarchical"
      ],
      "description": "Summarization strategy used"
    },
    "summary_metadata": {
      "type": "object",
      "required": [
        "processing_timestamp",
        "processing_duration_ms",
        "input_tokens",
        "output_tokens",
        "total_tokens",
        "estimated_cost_usd",
        "model_used",
        "quality_score",
        "quality_check_passed"
      ],
      "properties": {
        "processing_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when processing completed"
        },
        "processing_duration_ms": {
          "type": "number",
          "minimum": 0,
          "description": "End-to-end processing latency in milliseconds"
        },
        "input_tokens": {
          "type": "number",
          "minimum": 0,
          "description": "Tokens sent to LLM"
        },
        "output_tokens": {
          "type": "number",
          "minimum": 0,
          "description": "Tokens generated by LLM"
        },
        "total_tokens": {
          "type": "number",
          "minimum": 0,
          "description": "Total tokens (input + output)"
        },
        "estimated_cost_usd": {
          "type": "number",
          "minimum": 0,
          "description": "Estimated API cost in USD"
        },
        "model_used": {
          "type": "string",
          "pattern": "^[a-z0-9-]+/[a-z0-9-]+$",
          "description": "OpenRouter model ID used for generation",
          "examples": [
            "openai/gpt-oss-20b",
            "anthropic/claude-3.5-sonnet"
          ]
        },
        "quality_score": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Semantic similarity score (cosine similarity between original and summary Jina-v3 embeddings)"
        },
        "quality_check_passed": {
          "type": "boolean",
          "description": "True if quality_score >= quality_threshold (default: 0.75)"
        },
        "retry_attempts": {
          "type": "number",
          "minimum": 0,
          "description": "Number of retry attempts (0 = first attempt succeeded)"
        },
        "retry_strategy_changes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of strategy changes during retries (e.g., ['map_reduce->refine', 'llama->gpt4'])"
        },
        "detected_language": {
          "type": "string",
          "pattern": "^[a-z]{2}$",
          "description": "ISO 639-1 language code (e.g., 'ru', 'en')"
        },
        "character_to_token_ratio": {
          "type": "number",
          "minimum": 0,
          "description": "Language-specific character-to-token ratio used for estimation"
        },
        "chunk_count": {
          "type": "number",
          "minimum": 1,
          "description": "Number of chunks (for Map-Reduce, Map-Rerank strategies)"
        },
        "chunk_size_tokens": {
          "type": "number",
          "minimum": 1,
          "description": "Chunk size in tokens (for chunking strategies)"
        },
        "hierarchical_levels": {
          "type": "number",
          "minimum": 1,
          "description": "Depth of hierarchical tree (for Hierarchical strategy)"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
